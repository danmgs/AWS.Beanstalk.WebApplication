# AWS.Beanstalk.WebApplication
A demo web application in .NET Core for AWS Elastic Beanstalk. It is leveraging AWS DynamoDB and X-Ray services.

## 1. Prerequisites

### 1.1 EC2 Profile

Your elasticbeanstalk environment will have EC2 instance(s) which require the following role setup :
- default elasticbeanstalk role generated by AWS extended with additionnal:

    * SSM Role to log into EC2 via AWS Session manager console for debug. So, there's no need to attach the EC2 any keypair and any security group with RDP ingress rule.
    * Custom inline policy **"MyCustomPolicy"** for DynamoDB, X-Ray, SNS operations defined as below:

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "CustomPolicy",
            "Effect": "Allow",
            "Action": [                
                "sns:Publish",                
                "dynamodb:PutItem",
                "dynamodb:DescribeTable",
                "dynamodb:DeleteItem",                
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:UpdateItem",
                "xray:GetSamplingStatisticSummaries",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
                "xray:PutTraceSegments"
            ],
            "Resource": "*"
        }
    ]
}
```
EC2 profile should look like :

![alt capture](https://github.com/danmgs/AWS.Beanstalk.WebApplication/blob/master/img/configure_ec2_profile.PNG)

## 2. Getting started

- Run the script **AWS.Beanstalk.WebApplication\scripts\pack.bat** to generate the application file **bundle.zip** in the **output** directory.
This bundle contains :<br>
    * the application binaries
    * .ebextensions configuration files
        * custom environment variables,
        * elasticbeanstalk setup, 
        * aws resources such as Dynamodb table, 
        * X-Ray daemon setup ... etc 
	* a manisfest file **aws-windows-deployment-manifest.json** describing the deployment in IIS

- Under ElasticBeanstalk console, create an application then its environment with selected platform **.NET (Windows/IIS)** and upload the **bundle.zip** file.

- Once the environment is created, browse the website
    * play with the product page. Product items will be stored and retrieved from generated **Product** dynamoDB table.
    * check the X-Ray console for insights.

## 3. Some useful commands when connected into EC2

```bash
  # View application custom logs
    cat C:\logs\xray-sdk-log.txt
```

```bash
  # List all started services in windows
    net start
```

```bash
  # Stop and start any service: net stop/start servicename
    net stop "AWS X-Ray"
    net start "AWS X-Ray"
```

```bash
  # Restart IIS
    iisreset
```